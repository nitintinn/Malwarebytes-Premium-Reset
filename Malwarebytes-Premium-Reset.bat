:: ==================================================
::  Malwarebytes-Premium-Reset
:: ==================================================
::  Link - https://github.com/nitintinn/Malwarebytes-Premium-Reset
:: ==================================================


@echo off
title Malwarebytes-Premium-Reset ^| v3.0

:: Check for administrator privileges
fltmc >nul 2>&1 || (
    echo( && echo   [33m# Administrator privileges are required. && echo([0m
    PowerShell Start -Verb RunAs '%0' 2> nul || (
        echo   [33m# Right-click on the script and select "Run as administrator".[0m
        >nul pause && exit 1
    )
    exit 0
)

echo( && echo   [34mMalwarebytes[0m: Premium Automated 14 Day Trial Reset
echo( && echo   [[32m+[0m] Checking for existing scheduled task

:: Check if scheduled task already exists
schtasks /query /tn "Malwarebytes-Premium-Reset" >nul 2>&1
if not errorlevel 1 (
    echo( && echo   [[32m-[0m] Scheduled task already exists
) else (
    echo( && echo   [[32m+[0m] Creating scheduled task
    :: Create scheduled task to run every 14 days
    schtasks /create /tn "Malwarebytes-Premium-Reset" /tr "%~dpnx0" /sc weekly /mo 2 /ru SYSTEM /f >nul 2>&1
)

echo( && echo   [[32m+[0m] Spoofing cryptography [33mMachineGuid[0m

:: Generate new GUID and set it as MachineGuid
for /f %%a in ('powershell -c "[guid]::NewGuid().ToString()"') do (
    reg add "HKLM\SOFTWARE\Microsoft\Cryptography" /v "MachineGuid" /t REG_SZ /d "%%a" /f >nul
)

echo( && echo   [[32m+[0m] Done && pause >nul && timeout /t 3 >nul
